## 简介

gitignore 机制允许用户来指定哪些还未被追踪的文件将被版本控制系统忽略。注：仅适用于还未被追踪的文件，该机制对已经提交到版本控制系统的被追踪文件是无效的。

## 配置方式

根据用户的使用意图不同，gitignore 的配置方式也不同：

* 在项目中使用，并且想要把 gitignore 规则连同项目一起分发共享给其它用户

  这类 gitignore 规则往往意味着参与该项目的所有用户都会用到它们，此时一般我们会在项目的顶级目录中创建 `.gitignore` 文件来保存配置内容。且该文件会被提交到版本控制系统。

* 在项目中使用，但仅仅限于用户自己在本地使用

  有时用户会在项目中某些文档、数据，但又不想要把这些文件共享给其它用户，此时可以将这类 gitignore 规则写入项目目录中的 `$GIT_DIR/info/exclude` 文件。此文件是不会被提交到版本控制系统的。

* 用户本地的全局配置，针对于用户自己的操作系统、文本编辑器、编程语言以及 IDE 工具等工作环境

  用户一般都有自己偏好的工作环境，有时某些工具会产生临时文件，如：Mac OS 系统会产生 `.DS_Store` 文件，Python 脚本运行时会产生 `__pycache__` 目录。此时我们一般想要在所有项目中都忽略这些文件，也即进行全局配置：通过 Git 命令指定用户的全局 gitignore 配置文件位置：`git config --global core.excludesfile FILENAME`（全局配置文件的默认位置是 `$HOME/.config/git/ignore`），然后将规则写入该文件中。

以上的多种配置方式，是可以共同存在且有相互叠加的效果。在 Git 决定是否会忽略某个还未被追踪的文件或目录时，会综合考虑上述各个配置文件中的规则，按照一定优先级别来作出最终决定。上述各种方式的优先级依次递减。

## gitignore 规则

gitignore 配置文件中，每行内容指定一个文件匹配模式，被匹配到文件将会被版本控制系统忽略追踪。

模式语法如下：

* 空白行没有任何意义，可用来增加文件可读性。
* 一行内容在行尾的空白符没有任何意义。
* hash 字符 `#` 是文件中用于注释的字符，一行内容以 `#` 开头则是注释。
* slash 字符 `/` 在规则中的语义是用来表示目录的，可能出现在行首、行中、行尾。
* 不含有 slash 字符 `/` 的字符串，将被当成 shell 通配符来解析，可以使用通配符中的 `*`, `?`, `[]` 等元字符。
* 以 slash 字符 `/` 作为行首的，在顶级目录中进行匹配。
* 以 slash 字符 `/` 作为行尾的，不匹配文件项，只匹配任意位置的目录项。
* 行首的字符 `!` 表示对规则取反，也即规则本来用以指定排除哪些文件，行首添加 `!` 后则表示要包括这些文件。值得注意的是，这类规则要比定义在其前面的排除规则的优先级更高，也即某文件如果在前面被规则忽略不予以追踪了，后面可以使用取反规则来再次包括它。不过如果一个目录已经被之前的规则忽略了，那么取反规则是无法让该目录中的文件再次追踪的。
* backslash 字符 `\` 是文件中的转义符，可以用来对行首的 `#`, `!` 等字符转义，使其失去特定的语义，变为普通字符。
* 双星号 `**` 具有跨越目录层级的语义，出现在行首、行中、行尾分别具有不同的语义：
  * 行首且紧跟 slash 字符 `/` ，表示匹配任何位置 。如：规则 `**/foo` 匹配任何位置的 `foo` 文件或目录，等价于规则 `foo`；规则 `**/foo/bar` 将匹配任何地方的 `foo/bar` 文件或目录。
  * 行尾且前一个字符是 slash `/`，表示递归的匹配目录中的任何内容。如：规则 `foo/**` 将匹配目录 `foo` 中及其子目录中的任何内容。
  * 行中其前后都有一个slash `/` 字符，表示中间可以有任意多层级的目录。如：规则 `a/**/b` 既可以匹配 `a/x/b`，也可以匹配 `a/x/y/b`，还可以匹配 `a/b`。

## 规则模板

* GitHub 的 [gitignore](https://github.com/github/gitignore) 仓库含有常用的 gitignore 模板。
* [gitignore.io](https://www.gitignore.io/) 提供了线上服务，可以根据用户输入的环境来自动生成 gitignore 文件。

## 已追踪文件

要想使得 gitignore 对已提交的追踪文件生效，先要撤销对它们的追踪才行：

```
git rm --cached FILENAME
```

## 示例

目录结构如下：

```
project/
	data/
	foo/
		bar/
		non.ppt
	help.txt
	.gitignore
```

现在想要排除 project 中除了 foo/bar 目录和 .gitignore 文件以外的所有文件，则 .gitignore 内容如下：

```
# include .gitignore in anywhere
!.gitignore

# exclude everything in the top-level directory
/*
# include foo directory
!/foo
# exclude everythin underneath the foo directory
/foo/*
# include foo/bar directory
!/foo/bar
```

